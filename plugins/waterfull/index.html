
<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>Waterfall</title>
    <style>
        body,
        div,
        ul,
        li,
        img {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .ct {
            position: relative;
        }

        .list {
            display: block;
            margin: 0 auto;
            position: relative;
        }

        .list>li {
            width: 250px;
            position: absolute;
            margin-right: 10px;
            margin-top: 10px;
            transition: all 1s;
        }

        .list>li>img {
            width: 250px;
        }
    </style>
</head>

<body>
<div class="ct">
    <ul class="list">
        <li><img src="../../src/img/1.jpg"
                 alt=""></li>
        <li><img src="../../src/img/2.jpg"
                 alt=""></li>
        <li><img src="../../src/img/3.jpg"
                 alt=""></li>
        <li><img src="../../src/img/4.jpg"
                 alt=""></li>
        <li><img src="../../src/img/5.jpg"
                 alt=""></li>
        <li><img src="../../src/img/6.jpg"
                 alt=""></li>
        <li><img src="../../src/img/7.jpg"
                 alt=""></li>
        <li><img src="../../src/img/8.jpg"
                 alt=""></li>
        <li><img src="../../src/img/9.jpg"
                 alt=""></li>
        <li><img src="../../src/img/10.jpg"
                 alt=""></li>
        <li><img src="../../src/img/11.jpg"
                 alt=""></li>
        <li><img src="../../src/img/12.jpg"
                 alt=""></li>
        <li><img src="../../src/img/13.jpg"
                 alt=""></li>
    </ul>
</div>
<script src="../../src/jquery.min.js"></script>
<script>
    var winWidth, $imgLi, $imgUl, imgWidth, colNum, colHeightArr;
    init();
    layout();
    $(window).resize(function () {
        init();
        layout();
    })
    function init() {
        winWidth = $(window).width(),   //窗口宽
            $imgLi = $('.list>li'),
            $imgUl = $('.list'),            //ul
            imgWidth = $imgLi.eq(0).outerWidth(true),   //li宽
            colNum = parseInt(winWidth / imgWidth),     //列数
            colHeightArr = [];      //初始列高度数组
        $imgUl.css('width', colNum * imgWidth + 'px');     //ul获得高度

        for (var i = 0; i < colNum; i++) {
            colHeightArr.push(0);
        };
    }

    function layout() {
        var $imgs = $('.list img');
        $imgs.each(function () {
            console.log(this.complete);
            if (this.complete) {
                setPosition(this);
            }
        });

        $imgs.one('load', function () {
            setPosition(this);
        })
    }

    function setPosition(img) {
        var $imgLi = $(img).parent(),
            minObj = getMin(colHeightArr),
            minVal = minObj.minValue,
            minIndex = minObj.minIndex;
        $imgLi.css({
            'top': minVal,
            'left': minIndex * imgWidth
        });
        colHeightArr[minIndex] += $imgLi.outerHeight(true);
        console.log(colHeightArr);
    }

    function getMin(arr) {
        if (arr.length === 0) return;
        var index = 0,
            val = arr[0];
        for (var i = 0; i < arr.length; i++) {
            if (arr[i] < val) {
                val = arr[i];
                index = i;
            }
        }
        return { minValue: val, minIndex: index }
    }

</script>
</body>

</html>